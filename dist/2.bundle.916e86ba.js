(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{101:function(t,e,a){"use strict";var s=a(80);a.n(s).a},102:function(t,e,a){"use strict";var s=a(81);a.n(s).a},103:function(t,e,a){"use strict";var s=a(82);a.n(s).a},118:function(t,e,a){"use strict";a.r(e);var s=a(4),o={name:"addArticleDropDown",props:{dropdownParams:{type:Object,default:()=>({})}},computed:{...Object(s.d)({categoryList:t=>t.Category.categoryList,tagList:t=>t.Tag.tagList})},data:()=>({showDropdown:!1,params:{categoryId:"",labelId:[]}}),watch:{dropdownParams:function(t,e){this._initDropdownData(this.dropdownParams)}},mounted(){},methods:{...Object(s.b)("Category",["getCategoryList"]),...Object(s.b)("Tag",["getTagList"]),_handleDropdownClose(){this.$emit("on-click-release",this.params)},_handleAddArticleClick(){this.showDropdown=!this.showDropdown},clearSelectParams(){this.params.categoryId="",this.params.labelId=[]},_initDropdownData(t){Promise.all([this.getCategoryList(),this.getTagList()]).then(e=>{this.params=t})}}},i=(a(101),a(1)),r=Object(i.a)(o,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"add-article-dropdown"},[a("Dropdown",{attrs:{trigger:"custom",visible:t.showDropdown,placement:"bottom-end"}},[a("div",{staticStyle:{"text-align":"right",width:"150px"}},[a("Button",{attrs:{type:"primary",long:""},on:{click:t._handleAddArticleClick}},[t._v("发布")])],1),t._v(" "),a("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[a("div",{staticClass:"add-article-dropdown-container"},[a("h1",{staticClass:"add-article-dropdown-title"},[t._v("发布文章")]),t._v(" "),a("div",{staticClass:"add-article-dropdown-category"},[a("h2",[t._v("选择分类")]),t._v(" "),a("Select",{model:{value:t.params.categoryId,callback:function(e){t.$set(t.params,"categoryId",e)},expression:"params.categoryId"}},t._l(t.categoryList,function(e){return a("Option",{key:e._id,attrs:{value:e._id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("div",{staticClass:"add-article-dropdown-tag"},[a("h2",[t._v("标签")]),t._v(" "),a("Select",{attrs:{multiple:""},model:{value:t.params.labelId,callback:function(e){t.$set(t.params,"labelId",e)},expression:"params.labelId"}},t._l(t.tagList,function(e){return a("Option",{key:e._id,attrs:{value:e._id}},[t._v(t._s(e.name))])}))],1),t._v(" "),a("div",{staticClass:"add-article-dropdown-button"},[a("Button",{attrs:{type:"primary"},on:{click:t._handleDropdownClose}},[t._v("确定并发布")])],1)])])],1)],1)},[],!1,null,null,null);r.options.__file="index.vue";var d=r.exports,n=a(19),l={name:"LeeUpload",data:()=>({action:Object(n.a)()+"/img/upload",headers:{Authorization:"Bearer "+window.localStorage.getItem("token")},accept:"image/*",imgageUrl:"",uploadList:[]}),mounted(){this.uploadList=this.$refs.upload.fileList},methods:{handleRemove(t){this.uploadList=[],this.$emit("on-remove-img",t)}}},c=(a(102),Object(i.a)(l,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"lee-upload"},[t._l(t.uploadList,function(e){return a("div",{staticClass:"lee-upload-preview"},["finished"===e.status?["finished"===e.status?a("img",{attrs:{src:e.response.data.url,alt:"文章封面图片"}}):t._e(),t._v(" "),a("div",{staticClass:"lee-upload-preview-cover"},[a("Icon",{attrs:{type:"ios-trash-outline"},nativeOn:{click:function(a){t.handleRemove(e)}}})],1)]:t._e(),t._v(" "),[e.showProgress?a("Progress",{attrs:{percent:e.percentage,"hide-info":""}}):t._e()]],2)}),t._v(" "),a("Upload",{ref:"upload",attrs:{action:t.action,headers:t.headers,accept:t.accept,"show-upload-list":!1}},[0===t.uploadList.length?a("div",{staticClass:"lee-upload-border"},[a("p",[t._v("点击选择上传图片")])]):t._e()])],2)},[],!1,null,"2d2431f6",null));c.options.__file="index.vue";var p=c.exports,m=a(21),h=a(3);var u=class extends h.a{_delete(t){return this.post("img/delete",t)}};const g=new m.a,w=new u;var _={name:"addArticle",data:()=>({params:{_id:"",title:window.localStorage.getItem("title"),content:window.localStorage.getItem("content"),isPublish:!0,categoryId:"",labelId:[]},dropdownParams:{},config:{action:Object(n.a)()+"/img/upload",headers:{Authorization:"Bearer "+window.localStorage.getItem("token")}}}),watch:{"params.content":(t,e)=>{t!==e&&window.localStorage.setItem("content",t)},"params.title":(t,e)=>{t!==e&&window.localStorage.setItem("title",t)}},mounted(){"edit"===this.$route.query.type&&this._initUpdateArticle()},methods:{async _Add(t){try{const{data:{code:e,msg:a}}=await g.add(t);0===e?(this.$Message.success(a),this.clearParams(),this.$refs.addArticleDropdown.showDropdown=!1):this.$Message.error(a)}catch(t){this.$Message.error(t)}},async _Update(t){try{const{data:{code:e,msg:a}}=await g.update(t);0===e?(this.$Message.success(a),this.clearParams(),this.$router.go(-1)):this.$Message.error(a)}catch(t){}},async _getArticleById(t){try{const{data:{code:e,data:{_id:a,title:s,content:o,labelId:i,categoryId:r},msg:d}}=await g.getArticleById(t);0===e?(this.params={_id:a,title:s,content:o,labelId:[],categoryId:""},this.dropdownParams={labelId:this.initLabelIds(i),categoryId:r._id}):this.$Message.error(d)}catch(t){console.log(t)}},_handleOnClickRelease(t){const{categoryId:e,labelId:a}=t;this.params.categoryId=e,this.params.labelId=a;const s=this.validateParams(this.params);if(!0===s){const t=this.$route.query.type;"add"===t?(this._Add(this.params),this.$refs.addArticleDropdown.showDropdown=!1):"edit"===t&&this._Update(this.params)}else this.$Message.warning(s)},_initUpdateArticle(){const t=this.$route.query.id;this._getArticleById({_id:t,isEdit:!0})},validateParams(t){const{title:e,content:a,categoryId:s,labelId:o}=t;let i="";return i=""===e?"文章标题不能为空!":""===a?"内容不能为空!":""===s?"选择分类不能为空!":""!==o||"选择标签不难为空!"},clearParams(){this.params.title="",this.params.content="",window.localStorage.removeItem("title"),window.localStorage.removeItem("content"),this.$refs.addArticleDropdown.clearSelectParams()},handleOnRemoveImgClick(t){const{key:e}=t.response.data;this._deleteImg({key:e})},async _deleteImg(t){const{data:{code:e,msg:a}}=await w._delete(t);0===e?this.$Message.success(a):this.$Message.error(a)},initLabelIds(t){let e=[];return t.forEach(t=>{e.push(t._id)}),e},handleReturnImgUrl:t=>t.data.url},components:{addArticleDropdown:d,LeeUpload:p}},v=(a(103),Object(i.a)(_,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"add-article"},[a("Row",{attrs:{gutter:20}},[a("Col",{attrs:{span:"18"}},[a("Input",{attrs:{placeholder:"请输入文章标题"},model:{value:t.params.title,callback:function(e){t.$set(t.params,"title",e)},expression:"params.title"}})],1),t._v(" "),a("Col",{attrs:{span:"2"}},[a("Poptip",{attrs:{placement:"bottom"}},[a("div",{staticClass:"add-article-headerImg"},[a("Icon",{attrs:{type:"md-image",size:"32"}})],1),t._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},[a("h3",[t._v("文章封面图片上传")]),t._v(" "),a("LeeUpload",{on:{"on-remove-img":t.handleOnRemoveImgClick}})],1)])],1),t._v(" "),a("Col",{attrs:{span:"4"}},[a("add-article-dropdown",{ref:"addArticleDropdown",attrs:{dropdownParams:t.dropdownParams},on:{"on-click-release":t._handleOnClickRelease}})],1)],1),t._v(" "),a("div",{staticClass:"add-editor"},[a("i-editor",{attrs:{autosize:{minRows:25},config:t.config,"img-url":t.handleReturnImgUrl},model:{value:t.params.content,callback:function(e){t.$set(t.params,"content",e)},expression:"params.content"}})],1)],1)},[],!1,null,"243d0ac6",null));v.options.__file="index.vue";e.default=v.exports},80:function(t,e,a){},81:function(t,e,a){},82:function(t,e,a){}}]);